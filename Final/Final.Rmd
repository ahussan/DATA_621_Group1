---
title: "DATA 621 Final Project"
author: "Critical Thinking Group 1"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  pdf_document:
    toc: yes
    toc_depth: 4
  html_document:
    toc: yes
    toc_depth: '2'
    smart: no
  word_document:
    toc: yes
    toc_depth: '2'
---
\pagebreak
\begin{center}
\bigskip
\bigskip
\bigskip
Prepared for:\\
\medskip
Prof. Dr. Nasrin Khansari\\
\smallskip
City University of New York, School of Professional Studies - Data 621\\
\bigskip
DATA 621 – Business Analytics and Data Mining\\
\medskip
Home Work 5\\
\medskip
Prepared by:\\
\medskip
Critical Thinking Group  1\\ 
\medskip
Vic Chan\\ 
\smallskip
Gehad Gad\\
\smallskip
Evan McLaughlin\\  
\smallskip
Bruno de Melo\\
\smallskip
Anjal Hussan\\
\smallskip
Zhouxin Shi\\
\smallskip
Sie Siong Wong\\
\end{center}

\pagebreak

```{r message=FALSE, warning=FALSE, echo=FALSE}
if(!require('tidyverse')) (install.packages('tidyverse'))
```


\newpage

# Abstract
For the final project we will be using different predictive modeling techniques that we have learned throughout the course and using real world data in order to predict if a person has heart disease based on certain factors. The dataset for this final project [Heart Failure Prediction Dataset](https://www.kaggle.com/fedesoriano/heart-failure-prediction) can be found on Kaggle. Each observation in this dataset represents a person's health history, including their age, sex, cholesterol levels, etc. The dataset includes a total of 918 distinct individuals gathered from different countries and agencies. This dataset includes 12 different features, of categorical and/or continous values, of an individual health record, including if the individual has heart disease or not.

# Background
Cardiovascular diseases is the number 1 cause of death globally. The WHO records show that cardiovascular diseases accounted for 31% of all deaths worldwide in 2016.  According to the CDC, nearly 6.2 million adults in the United States suffer heart failure, and in 2018 alone, heart failure was mentioned on 379,800 death certificates. Also, the treatment cost of health care services and medicines is costly and estimated about 31 billion in 2012. Early detection and management for heart disease could be effective in reducing the incidence of heart failure. 

Note that heart failure occurs when the heart cannot pump enough blood and oxygen to support other organs in the body. With this dataset, we would like to see if we can develop a good model to predict if a person has heart disease and what factors can be attributed to heart disease most directly. We will be tackling this question with the usage of different regression techniques and algorithms learned from this class.

# Introduction
The reason why we have chosen this dataset to work with is because of how relavent this dataset is towards the real world. Heart disease is a condition which affects everyone and being able to successfully predict heart failure ahead of time can save millions of lives. Data scientist are studying everyday trying to understand the predictors of heart failure which is why datasets like this are often on Kaggle in order to gather data scientist from all over to help solve this issue in order to help society.

# Literature Review
Bruno

# Methodolgy

# Data Exploration
```{r}
# TODO: Split the dataset into a train and evaluation dataset
dataset = read.csv('https://raw.githubusercontent.com/ahussan/DATA_621_Group1/main/Final/heart.csv')

train_data = dataset
eval_data = dataset
```

# Data Preperation
In this section we will be looking at different ways to prepare the data for modeling and will be showing the different steps and reasons.

## Missing Data
This dataset seems to not have any missing data which is quite rare for a dataset. This means that there is not going to be a need to remove the NA rows or to replace the NA items with the median or mean.
```{r}
na_count = sapply(train_data, function(y) sum(is.na(y)))
na_count = data.frame(na_count)
na_count
```

## Duplicate Row
We will be wanting to remove all duplicate rows in the data set in order to make sure that we will not be skewing results when creating the model
```{r}
train_data = train_data %>% distinct()
```

It seems like that our dataset does not have any duplicates as we have the same amount of rows that we started with.

## Distribution of Heart Disease
Next we will be looking at how many data points do we have where the client has or does not have heart disease. We would like to make sure that the dataset is has a balance of people with and without heart disease in order to create an accurate model.

```{r}
train_data %>%
  count(HeartDisease)
```

As we can see from the result the dataset is also balanced as we have 410 datapoints which dont have heart disease and 508 data points with heart disease.

# Data preparation

To understand the data in a better way,I created the following table to explain the Definition and the value of each feature.


```{r echo=FALSE}
Feature <- c("Age", "Sex", "ChestPainType","RestingBP", "Cholesterol", "FastingBS", "RestingECG", "MaxHR", "ExerciseAngina", "Oldpeak", "ST_Slope", "HeartDisease" )
 
Definition <- c("Patient's age in years", "Gender", "Type of chest-pain", "Resting blood pressure in mmHg","Serum cholestoral in mg/dl", "Fasting blood sugar higher than 120 mg/dl", "Resting electrocardiographic results", "Maximum heart rate achieved", "Exercise induced angina", "ST depression induced by exercise relative to rest", "The slope of the peak exercise ST segment", 
"Diagnosis of heart disease")


Value <- c("28 - 77", "(0)female, (1)male", "(0)typical angina, (1)atypical angina, (2)non-angina pain, (3)asymptomatic", "0 - 200", "0 – 603", "(0)False (1)True", "(0)normal, (1)having ST-T wave abnormality,  (2)showing probable left ventricular hypertrophy", "60 –202", ("(0)No(1)Yes"), ("-2.6 - 6.2") ,  "(1)upsloping, (2)flat, (3)downsloping", 
"(0)heart disease not present, (1)heart disease present")

df <- data.frame(Feature, Definition, Value)
knitr::kable(df)

```

```{r}
str(train_data)
```

The 'str' function describes the structure of the data. We need to change/convert most of the features.


```{r}
#Change values to 0 and 1
#Sex
train_data$Sex<-ifelse(train_data$Sex=="M",1,0)
#ExerciseAngina
train_data$ExerciseAngina <- ifelse(train_data$ExerciseAngina == "Y", 1,0)

```

```{r}
#ChestPainType: Change typical angina (TA) to 0, atypical angina (ATA) to 1, non-angina pain(NAP) to 2, asymptomatic(ASY) to 3.
train_data$ChestPainType = factor(train_data$ChestPainType, levels = c('TA','ATA','NAP','ASY'), labels = c('0','1','2','3'))

#RestingECG: 0 for Normal, 1 for ST, and 2 for LVH
train_data$RestingECG = factor(train_data$RestingECG, levels = c('Normal','ST','LVH'), labels = c('0','1','2'))

#ST_Slope: 0 for UP, 1 for FLAT, and 2 for DOWN
train_data$ST_Slope = factor(train_data$ST_Slope, levels = c('Up','Flat','Down'), labels = c('0','1','2'))
```

```{r}
#Convert columns to factor
train_data$Sex <- as.factor(train_data$Sex)
train_data$ExerciseAngina <- as.factor(train_data$ExerciseAngina)
train_data$FastingBS <- as.factor(train_data$FastingBS)
train_data$HeartDisease <- as.factor(train_data$HeartDisease)

#Convert columns to num
train_data$RestingBP <- as.numeric(train_data$RestingBP)
train_data$Age <- as.numeric(train_data$Age)
train_data$Cholesterol <- as.numeric(train_data$Cholesterol)
train_data$MaxHR <- as.numeric(train_data$MaxHR)

```

## Distribution of Heart Disease among males and females

```{r}
xtabs(~ HeartDisease + Sex, data= train_data)
```
There are 50 females out of 193 who have diagnosed with heart disease and 458 males out of 725 were diagnosed with heart disease.

This indicates that 63% of males in this dataset are diagnosed with heart disease where is only 26% of females are diagnosed with heart disease.

**We can conclude that males are more diagnosed with heart disease than females**

```{r}
mosaicplot(train_data$Sex ~ train_data$HeartDisease,
           main="Heart disease outcome by Gender", shade=FALSE,color=TRUE,
           xlab="Gender", ylab="Heart disease")
```

**Numerical Variables**

```{r}
#Create a subset with numerical data
Numerical <- train_data  %>%
  select(Age,Oldpeak, MaxHR, Cholesterol, RestingBP,HeartDisease) %>% 
  gather(key = "key", value = "value", -HeartDisease)
```

```{r}
#Visualize numeric variables using boxplots
Numerical %>% 
  ggplot(aes(y = value)) +
       geom_boxplot(aes(fill = HeartDisease),
                      alpha  = .6,
                      fatten = .7) +
        labs(x = "",
             y = "",
             title = "Boxplots for Numeric Variables") +
      scale_fill_manual(
            values = c("#fde725ff", "#20a486ff"),
            name   = "Heart\nDisease",
            labels = c("No HD", "Yes HD")) +
      theme(
         axis.text.x  = element_blank(),
         axis.ticks.x = element_blank()) +
      facet_wrap(~ key, 
                 scales = "free", 
                 ncol   = 2) 
```

**Categorical Variables**

```{r}
#Create a subset for the categorical variables
Categorical <- train_data  %>%
  select(Sex, ChestPainType, FastingBS, RestingECG, ST_Slope,ExerciseAngina, HeartDisease) %>%
  gather(key = "key", value = "value", -HeartDisease)
```


```{r}

#Visualize with bar plot
Categorical %>% 
  ggplot(aes(value)) +
    geom_bar(aes(x        = value, 
                 fill     = HeartDisease), 
                 alpha    = .6, 
                 position = "dodge", 
                 color    = "black",
                 width    = .8
             ) +
    labs(x = "",
         y = "",
         title = "barplot for Categorical Variables") +
    theme(
         axis.text.y  = element_blank(),
         axis.ticks.y = element_blank()) +
    facet_wrap(~ key, scales = "free", nrow = 4) +
    scale_fill_manual(
         values = c("#fde725ff", "#20a486ff"),
         name   = "Heart\nDisease",
         labels = c("No diagnosis", " Diagnosed"))
```

## Outliers



# Model Creation

# Model Selection

# Conclusion'
